# Test Task Playbook
# テストタスク用のPlaybook

name: Test Task Playbook
description: テストの実行とカバレッジレポートの生成

steps:
  # 1. 依存関係のインストール
  - name: Install dependencies
    command: npm install
    timeout_seconds: 300
    retry_count: 2
    fail_fast: true

  # 2. リンターの実行
  - name: Run linter
    command: npm run lint
    condition: lint_enabled == true
    timeout_seconds: 120
    fail_fast: false

  # 3. 型チェック
  - name: Run type checker
    command: npm run type-check
    condition: typescript == true
    timeout_seconds: 180
    fail_fast: false

  # 4. ユニットテストの実行
  - name: Run unit tests
    command: npm test -- --run --coverage
    timeout_seconds: 600
    fail_fast: true

  # 5. 統合テストの実行
  - name: Run integration tests
    command: npm run test:integration -- --run
    condition: integration_tests_enabled == true
    timeout_seconds: 900
    fail_fast: true

  # 6. E2Eテストの実行
  - name: Run E2E tests
    command: npm run test:e2e -- --run
    condition: e2e_tests_enabled == true
    timeout_seconds: 1200
    fail_fast: false

  # 7. カバレッジレポートの生成
  - name: Generate coverage report
    command: npm run coverage:report
    condition: coverage_enabled == true
    timeout_seconds: 60
    fail_fast: false

  # 8. テスト結果のアップロード
  - name: Upload test results
    command: npm run upload:test-results
    condition: upload_enabled == true
    timeout_seconds: 120
    fail_fast: false

metadata:
  author: NecroCode Team
  version: 1.0.0
  tags:
    - test
    - qa
    - coverage
