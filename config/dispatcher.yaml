# Dispatcher Configuration
# 
# このファイルは、NecroCode Dispatcherの設定を定義します。
# Dispatcherは、Task RegistryからReadyタスクを監視し、
# Agent Poolに基づいてAgent Runnerに割り当てます。

dispatcher:
  # ポーリング間隔（秒）
  # Task Registryをチェックする頻度
  poll_interval: 5
  
  # スケジューリングポリシー
  # 選択肢: fifo, priority, skill-based, fair-share
  scheduling_policy: priority
  
  # グローバル最大同時実行数
  # すべてのAgent Poolを合わせた最大同時実行タスク数
  max_global_concurrency: 10
  
  # ハートビートタイムアウト（秒）
  # Agent Runnerからのハートビートが途絶えた場合のタイムアウト
  heartbeat_timeout: 60
  
  # 再試行設定
  retry:
    # 最大再試行回数
    max_attempts: 3
    
    # 指数バックオフの基数
    # 再試行間隔 = backoff_base ^ attempt_number
    backoff_base: 2.0
    
    # 初期再試行間隔（秒）
    initial_interval: 10
    
    # 最大再試行間隔（秒）
    max_interval: 300
  
  # グレースフルシャットダウン設定
  graceful_shutdown:
    # シャットダウンタイムアウト（秒）
    # 実行中のRunnerの完了を待つ最大時間
    timeout: 300
    
    # 強制終了を有効化
    force_kill_enabled: true
  
  # デッドロック検出設定
  deadlock_detection:
    # デッドロック検出を有効化
    enabled: true
    
    # 検出間隔（秒）
    check_interval: 60
    
    # 検出時の動作: warn, error, resolve
    action: warn
  
  # メトリクス設定
  metrics:
    # メトリクス収集を有効化
    enabled: true
    
    # 収集間隔（秒）
    collection_interval: 10
    
    # Prometheusエクスポートを有効化
    prometheus_enabled: true
    
    # Prometheusエクスポートポート
    prometheus_port: 9090
  
  # ログ設定
  logging:
    # ログレベル: DEBUG, INFO, WARNING, ERROR, CRITICAL
    level: INFO
    
    # ログファイルパス
    file: /var/log/necrocode/dispatcher.log
    
    # ログローテーション
    rotation:
      max_bytes: 10485760  # 10MB
      backup_count: 5

# Task Registry設定
task_registry:
  # Task Registryのベースディレクトリ
  base_dir: ~/.necrocode/task_registry
  
  # Task Registry APIエンドポイント（将来の拡張用）
  # api_endpoint: http://localhost:8080/api/v1

# Repo Pool Manager設定
repo_pool:
  # Repo Pool Managerのベースディレクトリ
  base_dir: ~/.necrocode/repo_pool
  
  # Repo Pool Manager APIエンドポイント（将来の拡張用）
  # api_endpoint: http://localhost:8081/api/v1
  
  # スロット割当タイムアウト（秒）
  allocation_timeout: 30
  
  # スロット解放タイムアウト（秒）
  release_timeout: 10

# Agent Runner設定
agent_runner:
  # Agent Runnerの実行タイムアウト（秒）
  # 0は無制限
  execution_timeout: 3600
  
  # Agent Runnerの環境変数
  environment:
    NECROCODE_ENV: production
    LOG_LEVEL: INFO
    PYTHONUNBUFFERED: "1"
  
  # Artifact Store設定
  artifact_store:
    # Artifact Storeのベースディレクトリ
    base_dir: ~/.necrocode/artifacts
    
    # Artifact Store APIエンドポイント（将来の拡張用）
    # api_endpoint: http://localhost:8082/api/v1

# 通知設定（将来の拡張用）
notifications:
  # 通知を有効化
  enabled: false
  
  # Slack通知
  slack:
    enabled: false
    webhook_url: ""
    channel: "#necrocode-alerts"
  
  # Email通知
  email:
    enabled: false
    smtp_host: ""
    smtp_port: 587
    from_address: ""
    to_addresses: []
